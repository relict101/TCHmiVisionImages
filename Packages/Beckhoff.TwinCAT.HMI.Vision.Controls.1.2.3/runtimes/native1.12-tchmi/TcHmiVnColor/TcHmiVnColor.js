var TcHmi,__awaiter=this&&this.__awaiter||function(t,o,e,s){return new(e||(e=Promise))((function(r,i){function l(t){try{a(s.next(t))}catch(t){i(t)}}function n(t){try{a(s.throw(t))}catch(t){i(t)}}function a(t){var o;t.done?r(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(l,n)}a((s=s.apply(t,o||[])).next())}))};!function(t){let o;!function(o){let e;!function(o){let e;!function(o){class e extends o.TcHmiVnControl{constructor(t,o,s){super(t,o,s),this.__$props=new e.Properties,this.__$controls=new e.SubControls,this.__colorValue=[0,0,0,0],this.__colorReturnType=e.ColorType.None,this.__domSliderKnobs=[],this.__colorSymbolWDF=null,this.__valuesControlsWDFs=[],this.__sliderControlsWDFs=[]}__attach(){this.__$dom.registerEx(["Container","ColorBox","ColorInput","TouchGuard"],".TcHmi_Controls_Beckhoff_Vision_TcHmiVnColor-"),super.__attach();try{this.__$dom.ColorBox.bind("click",(t=>{this.__$dom.available&&this.__$props.BoxUsage===e.Schema.UsageMode.Editable&&(this.__$dom.ColorInput.css("left",(t.offsetX||0).toString()+"px"),this.__$dom.ColorInput.css("top",(t.offsetY||0).toString()+"px"),setTimeout((()=>{this.__$dom.ColorInput[0].click()}),0))})),this.__$dom.ColorInput.bind("input",(s=>{const r=s.target.value;let i=o.Color.convertHexStringToArray(r)||[0,0,0];if(null!=this.__$props.BoxColorConversion)try{i=new t.Function(this.__$props.BoxColorConversion).execute([i,!0])}catch(t){this.__$log.warning("Could not execute ColorBoxConversion function in reverse.",t)}i=i.map(((t,o)=>this.__constrainValue(t/255*this.__$props.ColorChannels[o].maxValue,this.__$props.ColorChannels[o]))),this.__updateMasterColor(i,e.ColorInputMethod.Box,!0)})),this.__$dom.ColorInput.bind("change",(s=>{const r=s.target.value;let i=o.Color.convertHexStringToArray(r)||[0,0,0];if(null!=this.__$props.BoxColorConversion)try{i=new t.Function(this.__$props.BoxColorConversion).execute([i,!0])}catch(t){this.__$log.warning("Could not execute ColorBoxConversion function in reverse.",t)}i=i.map(((t,o)=>this.__constrainValue(t/255*this.__$props.ColorChannels[o].maxValue,this.__$props.ColorChannels[o]))),this.__updateMasterColor(i,e.ColorInputMethod.Box)})),this.__updateUILayout()}catch(t){console.log(t)}}destroy(){this.__keepAlive||(super.destroy(),this.__cleanupSubControls())}__updateMasterColor(t,o,e=!1){Array.isArray(t)&&t.length<=4?t.forEach(((t,o)=>{this.__colorValue[o]=t})):"number"==typeof t?this.__colorValue[0]=t:(this.__$log.warning("Invalid ColorValue when setting master color."),this.__colorValue=[0,0,0,0]),this.__$props.ColorChannels.forEach(((t,o)=>{this.__colorValue[o]=this.__constrainValue(this.__colorValue[o],t)})),e||this.__updateColorValue(),this.__updateUIData(o)}__constrainValue(t,o){const e=Math.max(0,Math.min(o.maxValue,t));return o.float?Math.floor(100*t)/100:Math.floor(e)}__updateColorValue(){switch(this.__colorReturnType){case e.ColorType.Number:this.__writeToColorSymbol(this.__colorValue[0]);break;case e.ColorType.Vector3:this.__writeToColorSymbol(this.__colorValue.slice(0,3));break;case e.ColorType.Vector4:this.__writeToColorSymbol(this.__colorValue);break;default:this.__setColorValueInternal(this.__colorValue)}}__updateUIData(t){if(!this.__$dom.available)return;const o=this.__colorStringForHTMLInput();this.__$props.BoxUsage!==e.Schema.UsageMode.Hide&&(this.__$dom.ColorBox.css("background-color",o),t!==e.ColorInputMethod.Box&&(this.__$dom.ColorInput[0].value=o));const s=this.__$props.ColorChannels.length;this.__$props.ValuesUsage!==e.Schema.UsageMode.Hide&&t!==e.ColorInputMethod.Values&&(this.__$controls.ValuesControls.length===s?this.__$controls.ValuesControls.forEach(((t,o)=>{t.setValue(this.__colorValue[o])})):this.__$log.warning("Dimension mismatch for ValuesControls")),this.__$props.SliderUsage!==e.Schema.UsageMode.Hide&&t!==e.ColorInputMethod.Slider&&(this.__$controls.SliderControls.length===s?this.__$controls.SliderControls.forEach(((t,o)=>{t.setValue(this.__colorValue[o])})):this.__$log.warning("Dimension mismatch for ValuesControls"))}__updateUILayout(){if(!this.__$dom.available)return;const o=this.__$props.ColorChannels.length,s=this.__$props.Orientation||e.Schema.Orientation.Horizontal,r=this.__computeLayoutSizes();if(this.__$props.BoxUsage===e.Schema.UsageMode.Hide?this.__$dom.ColorBox.css("display","none"):(this.__$dom.ColorBox.css("top","0"),this.__$dom.ColorBox.css("left","0"),s===e.Schema.Orientation.Horizontal?(this.__$dom.ColorBox.height(r.totalSize),this.__$dom.ColorBox.width(r.boxSize)):s===e.Schema.Orientation.Vertical&&(this.__$dom.ColorBox.height(r.boxSize),this.__$dom.ColorBox.width(r.totalSize)),this.__$dom.ColorBox.css("display","block")),this.__$props.ValuesUsage===e.Schema.UsageMode.Hide)this.__$controls.ValuesControls.forEach((t=>{t.destroy()})),this.__$controls.ValuesControls=[];else{for(;this.__$controls.ValuesControls.length>o;){const t=this.__$controls.ValuesControls.length-1;this.__$controls.ValuesControls[t].destroy(),this.__$controls.ValuesControls.splice(t,1),this.__valuesControlsWDFs[t]()}for(;this.__$controls.ValuesControls.length<o;){const o=this.__$controls.ValuesControls.length,s=this.__createValuesControl(o);if(null==s)return void this.__$log.error("Cannot create child controls (TcHmiTextbox).");this.__$controls.ValuesControls.push(s);const r=t.EventProvider.register(s.getId()+".onValueChanged",((t,o)=>{const s=t.name.replace(".onValueChanged",""),r=parseInt(s[s.length-1]);if(this.__$controls.ValuesControls.length>r){const t=this.__$controls.ValuesControls[r].getValue()||0,o=tchmi_clone_object(this.__colorValue);o[r]=this.__constrainValue(t,this.__$props.ColorChannels[r]),tchmi_equal(o,this.__colorValue)||this.__updateMasterColor(o,e.ColorInputMethod.Values)}}));this.__valuesControlsWDFs[o]=r}s===e.Schema.Orientation.Horizontal?(this.__$controls.ValuesControls.forEach(((t,o)=>{t.setWidth(r.valuesSize),t.setHeight(r.trackSize),t.setTop(o*r.trackSize),t.setLeft(r.boxSize),t.setDecimalDigits(this.__$props.ColorChannels[o].float?2:0)})),this.__$dom.TouchGuard.width(r.valuesSize),this.__$dom.TouchGuard.height(r.totalSize),this.__$dom.TouchGuard.css("top","0"),this.__$dom.TouchGuard.css("left",r.boxSize.toString()+"px")):s===e.Schema.Orientation.Vertical&&(this.__$controls.ValuesControls.forEach(((t,o)=>{t.setWidth(r.trackSize),t.setHeight(r.valuesSize),t.setTop(r.boxSize),t.setLeft(o*r.trackSize),t.setDecimalDigits(this.__$props.ColorChannels[o].float?2:0)})),this.__$dom.TouchGuard.width(r.totalSize),this.__$dom.TouchGuard.height(r.valuesSize),this.__$dom.TouchGuard.css("top",r.boxSize.toString()+"px"),this.__$dom.TouchGuard.css("left","0")),this.__$props.ColorChannels.forEach(((t,o)=>{this.__$controls.ValuesControls[o].setValueColor(t.color)})),this.__$props.ValuesUsage===e.Schema.UsageMode.Editable?this.__$dom.TouchGuard.css("display","none"):this.__$dom.TouchGuard.css("display","block")}if(this.__$props.SliderUsage===e.Schema.UsageMode.Hide)this.__$controls.SliderControls.forEach((t=>{t.destroy()})),this.__$controls.SliderControls=[];else{for(;this.__$controls.SliderControls.length>o;){const t=this.__$controls.SliderControls.length-1;this.__$controls.SliderControls[t].destroy(),this.__$controls.SliderControls.splice(t,1),this.__sliderControlsWDFs[t](),delete this.__domSliderKnobs[t]}for(;this.__$controls.SliderControls.length<o;){const o=this.__$controls.SliderControls.length,s=this.__createSliderControl(o);if(null==s)return void this.__$log.error("Cannot create child controls (TcHmiLinearGauge).");window.setTimeout((()=>{const t=s.getElement().find(".TcHmi_Controls_Beckhoff_TcHmiLinearGauge-template-knob");null!=t&&this.__domSliderKnobs.push(t)}),0),r.trackSize<40&&window.setTimeout((()=>{this.__updateUILayout()}),0),this.__$controls.SliderControls.push(s);const i=t=>{const o=t.name.replace(".onUserInteractionFinished",""),s=parseInt(o[o.length-1]);if(this.__$controls.SliderControls.length>s){const t=this.__$controls.SliderControls[s].getValue()||0,o=tchmi_clone_object(this.__colorValue);o[s]=this.__constrainValue(t,this.__$props.ColorChannels[s]),this.__updateMasterColor(o,e.ColorInputMethod.Slider)}},l=t=>{const o=t.name.replace(".onValueChanged",""),s=parseInt(o[o.length-1]);if(this.__$controls.SliderControls.length>s){const t=this.__$controls.SliderControls[s].getValue()||0,o=tchmi_clone_object(this.__colorValue);o[s]=this.__constrainValue(t,this.__$props.ColorChannels[s]),tchmi_equal(o,this.__colorValue)||this.__updateMasterColor(o,e.ColorInputMethod.Slider,!0)}},n=t.EventProvider.register(s.getId()+".onUserInteractionFinished",i),a=t.EventProvider.register(s.getId()+".onValueChanged",l),_=()=>{n(),a()};this.__sliderControlsWDFs[o]=_}const i=Math.min(r.trackSize/40,1),l=5*i,n=l+15*i;s===e.Schema.Orientation.Horizontal?(this.__$controls.SliderControls.length>0&&r.sliderSize<e.Settings.SliderWarningThreshold&&this.__$log.warning("Due to its horizontal size, the TcHmiVnColor control might be compromised. Consider increasing it's size to make all functionality available."),this.__$controls.SliderControls.forEach(((t,o)=>{t.setWidth(r.sliderSize-n),t.setHeight(r.trackSize),t.setTop(o*r.trackSize),t.setLeft(r.boxSize+r.valuesSize+l),t.setOrientation(s),t.setMaxValue(this.__$props.ColorChannels[o].maxValue)}))):s===e.Schema.Orientation.Vertical&&(this.__$controls.SliderControls.length>0&&r.sliderSize<e.Settings.SliderWarningThreshold&&this.__$log.warning("Due to its vertical size, the TcHmiVnColor control might be compromised. Consider increasing it's size to make all functionality available."),this.__$controls.SliderControls.forEach(((t,o)=>{t.setWidth(r.trackSize),t.setHeight(r.sliderSize-n),t.setTop(r.boxSize+r.valuesSize+l),t.setLeft(o*r.trackSize),t.setOrientation(s),t.setMaxValue(this.__$props.ColorChannels[o].maxValue)}))),this.__$controls.SliderControls.forEach(((t,o)=>{null!=this.__domSliderKnobs[o]&&(this.__$props.Orientation===e.Schema.Orientation.Horizontal?this.__domSliderKnobs[o].css("transform",`translate(-20px, -20px) scale(${i})`):this.__domSliderKnobs[o].css("transform",`translate(-20px, 20px) scale(${i})`))}));const a=this.__$props.SliderUsage===e.Schema.UsageMode.Editable;this.__$props.ColorChannels.forEach(((t,o)=>{this.__$controls.SliderControls[o].setProgressForegroundColor(t.color),this.__$controls.SliderControls[o].setEditable(a)}))}this.__updateUIData(null)}__computeLayoutSizes(){const t=this.__element[0].clientWidth,o=this.__element[0].clientHeight,s=t-2*e.Settings.Padding,r=o-2*e.Settings.Padding,i=this.__$props.ColorChannels.length,l=this.__$props.Orientation||e.Schema.Orientation.Horizontal,n=!(this.__$props.BoxUsage===e.Schema.UsageMode.Hide),a=!(this.__$props.ValuesUsage===e.Schema.UsageMode.Hide),_=!(this.__$props.SliderUsage==e.Schema.UsageMode.Hide),h=this.__$props.BoxSize,c=this.__$props.ValuesSize;let u,d,p,C;l===e.Schema.Orientation.Horizontal?(u=Math.floor((r||0)/i),p=a?Math.min(c,s):0,d=n?Math.min(h,s-p):0,C=_?s-p-d:0):l===e.Schema.Orientation.Vertical&&(u=Math.floor((s||0)/i),p=a?Math.min(c,r):0,d=n?Math.min(h,r-p):0,C=_?r-p-d:0);return{totalSize:u*i,trackSize:u,boxSize:d,valuesSize:p,sliderSize:C}}__colorStringForHTMLInput(){if(null==this.__$props.BoxColorConversion)return this.__colorStringFromInternalMaxValues();try{const e=new t.Function(this.__$props.BoxColorConversion).execute([this.__colorValue,!1]);if(null!=e){return o.Color.convertArrayToHexString(e)}return this.__colorStringFromInternalMaxValues()}catch(t){return this.__$log.warning("Could not execute InfobarShapeFormat function.",t),this.__colorStringFromInternalMaxValues()}}__colorStringFromInternalMaxValues(){let t=tchmi_clone_object(this.__colorValue);if(1===this.__$props.ColorChannels.length)return t[0]=Math.min(Math.floor(t[0]/this.__$props.ColorChannels[0].maxValue*255),255),o.Color.convertArrayToHexString([t[0],t[0],t[0]])||"#000000";{const e=[255,255,255,1];for(let o=0;o<3;++o)null!=this.__$props.ColorChannels[o]&&(t[o]=Math.min(Math.floor(t[o]/this.__$props.ColorChannels[o].maxValue*e[o]),e[o]));return o.Color.convertArrayToHexString(t.slice(0,3))||"#000000"}}__createValuesControl(o){const s=tchmi_clone_object(e.Settings.NumericInputAttributes);let r;const i=t.Theme.Resources;return s["data-tchmi-value-horizontal-alignment"]="Center",r=i.get(this,"TextFontSize"),s["data-tchmi-value-font-size"]=r.value,r=i.get(this,"TextFontSizeUnit"),s["data-tchmi-value-font-size-unit"]=r.value,r=i.get(this,"TextPadding"),s["data-tchmi-content-padding"]=r.value,r=i.get(this,"TextFontFamily"),s["data-tchmi-value-font-family"]=r.value,r=i.get(this,"TextFontStyle"),s["data-tchmi-value-font-style"]=r.value,r=i.get(this,"TextFontWeight"),s["data-tchmi-value-font-weight"]=r.value,this.__$createSubControl("TcHmiNumericInput","Values-"+o.toString(),s,this.__$dom.Container)}__createSliderControl(t){const o=tchmi_clone_object(e.Settings.LinearGaugeAttributes);return this.__$createSubControl("TcHmiLinearGauge","Slider-"+t.toString(),o,this.__$dom.Container)}__cleanupSubControls(){this.__$controls.ValuesControls.forEach(((t,o)=>{this.__valuesControlsWDFs[o]()})),this.__$controls.SliderControls.forEach(((t,o)=>{this.__sliderControlsWDFs[o]()})),this.__$controls.ValuesControls=[],this.__$controls.SliderControls=[],this.__valuesControlsWDFs=[],this.__sliderControlsWDFs=[]}__restrictUsage(o){return t.Access.checkAccess(this,"observe")?t.Access.checkAccess(this,"operate")||o!==e.Schema.UsageMode.Editable?o:e.Schema.UsageMode.ViewOnly:e.Schema.UsageMode.Hide}__writeToColorSymbol(o){this.__setColorValueInternal(o),this.__$props.ColorSymbol instanceof t.Symbol&&this.__$props.ColorSymbol.write(o)}__updateColorReturnType(t){return __awaiter(this,void 0,void 0,(function*(){const o=yield new Promise(((o,e)=>{t.resolveSchema((t=>{t.error?e(t.error):o(t.schema||{})}))}));o.type,"number"===o.type?this.__colorReturnType=e.ColorType.Number:"array"===o.type?(3!==o.maxItems&&3!==o.maxLength||(this.__colorReturnType=e.ColorType.Vector3),null!=o.maxItems&&o.maxItems<3||null!=o.maxLength&&o.maxLength<3?(this.__$log.warning(`Symbol ${t.getExpression()} of type ${o.id} might not be a valid type for TcHmiVnColor's return value.`),this.__colorReturnType=e.ColorType.Vector4):this.__colorReturnType=e.ColorType.Vector4):(this.__$log.warning(`Symbol ${t.getExpression()} of type ${o.id} might not be a valid type for TcHmiVnColor's return value.`),this.__colorReturnType=e.ColorType.Vector4)}))}__processWidth(){super.__processWidth(),this.__isAttached&&this.__updateUILayout()}__processHeight(){super.__processHeight(),this.__isAttached&&this.__updateUILayout()}setVisibility(t){super.setVisibility(t),this.__updateUILayout()}getColorSymbol(){return this.__$props.ColorSymbol}setColorSymbol(t){this.__$setProperty("ColorSymbol",t)}__setColorSymbolInternal(t){this.__$setPropertyInternal("ColorSymbol",t)}__processColorSymbol(o){return __awaiter(this,void 0,void 0,(function*(){null!=this.__colorSymbolWDF&&(this.__colorSymbolWDF.call(this),this.__colorSymbolWDF=null),o instanceof t.Symbol?(this.__updateColorReturnType(o),this.__colorSymbolWDF=o.watch((o=>{o.error===t.Errors.NONE&&this.__updateMasterColor(o.value,e.ColorInputMethod.Property)}))):this.__colorReturnType=e.ColorType.None}))}getColorValue(){return this.__$props.ColorValue}__setColorValueInternal(t){this.__$setPropertyInternal("ColorValue",t)}setColorValue(t){this.__updateMasterColor(t,e.ColorInputMethod.Property)}getColorChannels(){return this.__$props.ColorChannels}setColorChannels(t){this.__$setProperty("ColorChannels",t)}__processColorChannels(){this.__updateUILayout()}getBoxColorConversion(){return this.__$props.BoxColorConversion}setBoxColorConversion(t){this.__$setProperty("BoxColorConversion",t)}__processBoxColorConversion(){this.__updateUILayout()}getBoxUsage(){return this.__$props.BoxUsage}setBoxUsage(t){this.__$setProperty("BoxUsage",this.__restrictUsage(t))}__processBoxUsage(){this.__updateUILayout()}getValuesUsage(){return this.__$props.ValuesUsage}setValuesUsage(t){this.__$setProperty("ValuesUsage",this.__restrictUsage(t))}__processValuesUsage(){this.__updateUILayout()}getSliderUsage(){return this.__$props.SliderUsage}setSliderUsage(t){this.__$setProperty("SliderUsage",this.__restrictUsage(t))}__processSliderUsage(){this.__updateUILayout()}getOrientation(){return this.__$props.Orientation}setOrientation(t){this.__$setProperty("Orientation",t)}__processOrientation(){this.__updateUILayout()}getBoxSize(){return this.__$props.BoxSize}setBoxSize(t){this.__$setProperty("BoxSize",t)}__processBoxSize(){this.__updateUILayout()}getBoxSizeUnit(){return"px"}setBoxSizeUnit(t){}getValuesSize(){return this.__$props.ValuesSize}setValuesSize(t){this.__$setProperty("ValuesSize",t)}__processValuesSize(){this.__updateUILayout()}getValuesSizeUnit(){return"px"}setValuesSizeUnit(t){}}o.TcHmiVnColor=e,function(t){class e extends o.TcHmiVnControl.Properties{constructor(){super(...arguments),this.ColorSymbol=null,this.ColorValue=[0,0,0,0],this.ColorChannels=[{color:{color:"rgba(255, 0, 0, 1)"},maxValue:255,float:!1},{color:{color:"rgba(0, 255, 0, 1)"},maxValue:255,float:!1},{color:{color:"rgba(0, 0, 255, 1)"},maxValue:255,float:!1}],this.BoxUsage=r.UsageMode.ViewOnly,this.ValuesUsage=r.UsageMode.Editable,this.SliderUsage=r.UsageMode.Editable,this.Orientation=r.Orientation.Horizontal,this.BoxColorConversion=null,this.BoxSize=50,this.ValuesSize=50}}t.Properties=e;class s extends o.TcHmiVnControl.SubControls{constructor(){super(...arguments),this.ValuesControls=[],this.SliderControls=[]}}let r,i,l,n;t.SubControls=s,function(t){let o,e;!function(t){t.Hide="Hide",t.ViewOnly="ViewOnly",t.Editable="Editable"}(o=t.UsageMode||(t.UsageMode={})),function(t){t.Horizontal="Horizontal",t.Vertical="Vertical"}(e=t.Orientation||(t.Orientation={}))}(r=t.Schema||(t.Schema={})),function(t){t.SliderWarningThreshold=50,t.Padding=5,t.LinearGaugeAttributes={"data-tchmi-base-animation-time":"300","data-tchmi-height":"67","data-tchmi-height-unit":"px","data-tchmi-label-range":"20","data-tchmi-left":"453","data-tchmi-left-unit":"px","data-tchmi-show-labels":"False","data-tchmi-show-ticks":"False","data-tchmi-show-value-text":"False","data-tchmi-start-from-zero":"True","data-tchmi-top":"368","data-tchmi-top-unit":"px","data-tchmi-width":"360","data-tchmi-width-unit":"px","data-tchmi-editable":"True","data-tchmi-max-value":"255","data-tchmi-min-value":"0","data-tchmi-value":"0","data-tchmi-orientation":"Horizontal","data-tchmi-padding":{left:3,right:3,top:3,bottom:3,leftUnit:"px",rightUnit:"px",topUnit:"px",bottomUnit:"px"},"data-tchmi-background-color":{color:"None"}},t.NumericInputAttributes={"data-tchmi-height":"26","data-tchmi-height-unit":"px","data-tchmi-left":"214","data-tchmi-left-unit":"px","data-tchmi-text":"Textbox","data-tchmi-top":"506","data-tchmi-top-unit":"px","data-tchmi-width":"113","data-tchmi-width-unit":"px","data-tchmi-is-enabled":"True","data-tchmi-text-horizontal-alignment":"Center","data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3},"data-tchmi-background-color":{color:"None"},"data-tchmi-border-color":{color:"None"},"data-tchmi-text-font-weight":"Bold"}}(i=t.Settings||(t.Settings={})),function(t){t.Property="Property",t.Box="Box",t.Values="Values",t.Slider="Slider"}(l=t.ColorInputMethod||(t.ColorInputMethod={})),function(t){t.None="None",t.Number="Number",t.Vector3="Vector3",t.Vector4="Vector4"}(n=t.ColorType||(t.ColorType={}))}(e=o.TcHmiVnColor||(o.TcHmiVnColor={}))}(e=o.Vision||(o.Vision={}))}(e=o.Beckhoff||(o.Beckhoff={})),o.registerEx("TcHmiVnColor","TcHmi.Controls.Beckhoff.Vision",e.Vision.TcHmiVnColor)}(o=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));